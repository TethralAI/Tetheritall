apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: selfsigned-issuer
spec:
  selfSigned: {}
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: iot-root-ca
  namespace: iot
spec:
  isCA: true
  commonName: iot-root-ca
  secretName: iot-root-ca
  issuerRef:
    name: selfsigned-issuer
    kind: ClusterIssuer
---
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: iot-ca-issuer
spec:
  ca:
    secretName: iot-root-ca
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: api-cert
  namespace: iot
spec:
  secretName: api-tls
  dnsNames:
    - api.example.local
  issuerRef:
    name: iot-ca-issuer
    kind: ClusterIssuer
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: gateway-cert
  namespace: iot
spec:
  secretName: gateway-tls
  dnsNames:
    - gateway.example.local
  issuerRef:
    name: iot-ca-issuer
    kind: ClusterIssuer
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: integrations-cert
  namespace: iot
spec:
  secretName: integrations-tls
  dnsNames:
    - integrations.example.local
  issuerRef:
    name: iot-ca-issuer
    kind: ClusterIssuer
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: gateway-client-cert
  namespace: iot
spec:
  secretName: gateway-client-tls
  commonName: gateway-client
  usages: [ "client auth" ]
  issuerRef:
    name: iot-ca-issuer
    kind: ClusterIssuer